fig1
df <- read.xlsx('./annual_us.xlsx', sheet = 'UK')
df <- df |>
pivot_longer(cols = 2:ncol(df), names_to = 'age_group', values_to = 'count') |>
mutate(age_group_10 = case_when(
age_group == "No.information.provided" ~ 'Missing',
age_group == '00-04' ~ '00-04',
age_group == '05-09' ~ '05-09',
age_group == '10-14' ~ '10-14',
# other age groups
TRUE ~ '15+'
))
names(df)[1] <- 'year'
df <- df |>
filter(year <= 2023)
fig4 <- ggplot(df, aes(x = year, y = count, fill = age_group_10)) +
geom_col(position = 'fill') +
coord_cartesian(ylim = c(0, 1)) +
scale_fill_viridis_d()+
scale_x_continuous(breaks = breaks,
limits = c(1990.5, 2023.5),
expand = c(0, 0)) +
scale_y_continuous(labels = scales::percent_format(),
expand = c(0, 0)) +
theme_bw() +
labs(title = 'd',
x = 'Year',
y = 'Percentage',
fill = 'Age Group')
fig4
ggsave(filename = './appendix/S6.png',
plot = fig1 + fig4 + plot_layout(ncol = 1) & theme(legend.position = 'bottom'),
width = 12,
height = 5)
library(patchwork)
ggsave(filename = './appendix/S6.png',
plot = fig1 + fig4 + plot_layout(ncol = 1) & theme(legend.position = 'bottom'),
width = 12,
height = 5)
fig4 <- ggplot(df, aes(x = year, y = count, fill = age_group_10)) +
geom_col(position = 'fill', show.legend = F) +
coord_cartesian(ylim = c(0, 1)) +
scale_fill_viridis_d()+
scale_x_continuous(breaks = breaks,
limits = c(1990.5, 2023.5),
expand = c(0, 0)) +
scale_y_continuous(labels = scales::percent_format(),
expand = c(0, 0)) +
theme_bw() +
labs(title = 'd',
x = 'Year',
y = 'Percentage',
fill = 'Age Group')
ggsave(filename = './appendix/S6.png',
plot = fig1 + fig4 + plot_layout(ncol = 1) & theme(legend.position = 'bottom'),
width = 12,
height = 5)
ggsave(filename = './appendix/S6.png',
plot = fig1 + fig4 + plot_layout(ncol = 1) & theme(legend.position = 'bottom'),
width = 12,
height = 10)
df <- read.xlsx('./annual_us.xlsx', sheet = 'UK')
df <- df |>
pivot_longer(cols = 2:ncol(df), names_to = 'age_group', values_to = 'count') |>
mutate(age_group_10 = case_when(
age_group == "No.information.provided" ~ 'Missing',
age_group == '00-04' ~ '00-04',
age_group == '05-09' ~ '05-09',
age_group == '10-14' ~ '10-14',
# other age groups
TRUE ~ '15+'
))
View(df)
names(df)[1] <- 'year'
df <- df |>
filter(year <= 2023)
fill_colors <- paletteer_d("viridis", 5)
library(viridis)
breaks <- seq(1991, 2023, 2)
fill_colors <- paletteer_d("viridis", 5)
fill_colors <- paletteer_d("viridis", 5)
library(ggsci)
breaks <- seq(1991, 2023, 2)
fill_color <- pal_npg()(3)
fill_color <- pal_npg()(5)
fill_color
names(fill_color) <- c('00-04', '05-09', '10-14', '15+', 'Missing')
source("D:/OneDrive - stu.xmu.edu.cn/XMU/likangguo/2024/06 pertussis/WC_global/Analysis/fig1_age_group.R", echo=TRUE)
source("D:/OneDrive - stu.xmu.edu.cn/XMU/likangguo/2024/06 pertussis/WC_global/Analysis/fig1_age_group.R", echo=TRUE)
df_1 <- read.xlsx("Fig Data/fig1.xlsx")
df_1
df_1 <- read.xlsx("Fig Data/fig1.xlsx")
country_list <- unique(df_1$Country)
country_list <- sort(unique(df_1$Country))
i <- 1
country_list <- sort(unique(df_1$Country))
df_country <- df_1 %>% filter(Country == country)
i <- 1
country_list <- sort(unique(df_1$Country))
country <- country_list[i]
df_country <- df_1 %>% filter(Country == country)
df_country <- df_country %>% select(-Country)
View(df_country)
df_1 <- read.xlsx("Fig Data/fig1.xlsx")
i <- 1
country_list <- sort(unique(df_1$Country))
library(tidyverse)
library(lubridate)
library(ggsci)
library(patchwork)
library(openxlsx)
library(purrr)
fill_color <- pal_npg()(3)
# Load data
df_raw <- read.csv('./report_pertussis.csv')
View(df_raw)
source("D:/OneDrive - stu.xmu.edu.cn/XMU/likangguo/2024/06 pertussis/WC_global/Analysis/fig1_epidemic_curve.R", echo=TRUE)
library(tidyverse)
library(lubridate)
library(ggsci)
library(patchwork)
library(openxlsx)
library(purrr)
fill_color <- pal_npg()(3)
# Load data
df_raw <- read.csv('./report_pertussis.csv')
scientific_10 <- function(x) {
ifelse(x == 0, 0, parse(text = gsub("[+]", "", gsub("e", "%*%10^", scales::scientific_format()(x)))))
}
# clean data --------------------------------------------------------------
df_epiweek <- data.frame(date = seq.Date(from = as.Date('2015-01-04'), to = as.Date('2024-03-09'), by = 'day')) |>
mutate(Year = epiyear(date),
Week = epiweek(date)) |>
group_by(Year, Week) |>
summarise(Date = last(date),
.groups = 'drop')
df_us <- df_raw |>
filter(Country == 'US') |>
select(Year, Week, Cases, URL)
df_us <- left_join(df_epiweek, df_us, by = c('Year', 'Week')) |>
arrange(Date) |>
mutate(Cases = as.integer(Cases),
Country = 'US')
df_uk <- df_raw |>
filter(Country == 'UK') |>
select(Year, Week, Cases, URL)
df_uk <- left_join(df_epiweek, df_uk, by = c('Year', 'Week')) |>
arrange(Date) |>
mutate(Cases = as.integer(Cases),
Country = 'UK')
df_cn <- df_raw |>
filter(Country == 'CN') |>
select(Year, Month, Cases, URL) |>
mutate(Cases = as.integer(Cases),
Date = as.Date(paste(Year, Month, '01', sep = '-')),
Country = 'CN')
df_au <- df_raw |>
filter(Country == 'AU') |>
select(Year, Month, Cases, URL) |>
mutate(Cases = as.integer(Cases),
Date = as.Date(paste(Year, Month, '01', sep = '-')),
Country = 'AU')
df_clean <- bind_rows(df_us, df_uk, df_cn, df_au) |>
arrange(Date) |>
select(Country, Date, Year, Month, Week, Cases) |>
mutate(stage = case_when(
Date < as.Date('2020-01-01') ~ '2015 Jan to 2019 Dec',
Date >= as.Date('2020-01-01') & Date < as.Date('2023-07-01') ~ '2020 Jan to 2023 Jun',
Date >= as.Date('2023-07-01') ~ '2023 Jun onwards'
))
ggplot(df_clean, aes(x = Date, y = Cases, color = Country)) +
geom_line() +
scale_x_date(date_labels = '%Y') +
scale_y_continuous(labels = scales::comma) +
facet_wrap(~Country, scales = 'free_y', nrow = 3) +
labs(title = 'Epidemic curve of pertussis cases',
x = 'Date',
y = 'Cases',
color = 'Country') +
theme_bw() +
theme(legend.position = 'none')
source("D:/OneDrive - stu.xmu.edu.cn/XMU/likangguo/2024/06 pertussis/WC_global/Analysis/fig1_epidemic_curve.R", echo=TRUE)
country <- country_list[i]
df_country <- df_1 %>% filter(Country == country)
df_country <- df_1  |>
filter(Country == country) |>
select(-Country)
library(openxlsx)
library(tidyverse)
# figure 1 ----------------------------------------------------------------
df_1 <- read.xlsx("Fig Data/fig1.xlsx")
i <- 1
country_list <- sort(unique(df_1$Country))
country <- country_list[i]
df_country <- df_1  |>
filter(Country == country) |>
select(-Country)
View(df_country)
df_1 <- read.xlsx("Fig Data/fig1.xlsx",
detectDates = TRUE)
i <- 1
country_list <- sort(unique(df_1$Country))
country <- country_list[i]
df_country <- df_1  |>
filter(Country == country) |>
select(-Country)
df_1 <- read.xlsx("Fig Data/fig1.xlsx",
detectDates = TRUE)
View(df_1)
i <- 1
country_list <- sort(unique(df_1$Country))
country <- country_list[i]
df_country <- df_1  |>
filter(Country == country) |>
select(-Country)
View(df_country)
fig <- list()
df_country <- df_countrydata |>
group_by(Year) |>
filter(Year < 2024) |>
summarise(Cases = sum(Cases))
df_country <- df_country |>
group_by(Year) |>
filter(Year < 2024) |>
summarise(Cases = sum(Cases))
View(df_country)
fig <- list()
for (i in 1:length(country_list)) {
country <- country_list[i]
df_country <- df_1  |>
filter(Country == country) |>
select(-Country)
fig[[paste('panel', letters[i*2-1])]] <- df_country
df_country <- df_country |>
group_by(Year) |>
filter(Year < 2024) |>
summarise(Cases = sum(Cases))
fig[[paste('panel', letters[i*2])]] <- df_country
}
View(fig)
write.xlsx(fig, "Fig Data/fig1.xlsx", asTable = TRUE, rowNames = FALSE)
source("D:/OneDrive - stu.xmu.edu.cn/XMU/likangguo/2024/06 pertussis/WC_global/Analysis/fig1_epidemic_curve.R", echo=TRUE)
write.xlsx(fig, "appendix/fig data/fig 1.xlsx", asTable = TRUE, rowNames = FALSE)
df_1 <- read.xlsx("Fig Data/fig2.xlsx",
sheet = "Sheet 1",
detectDates = TRUE)
View(df_1)
df_2 <- read.xlsx("Fig Data/fig2.xlsx",
sheet = "Sheet 2",
detectDates = TRUE)
remove(df_1, i, country_list, fig, country, df_country)
i <- 1
country_list <- sort(unique(df_1$Country))
fig <- list()
i <- 1
country_list <- sort(unique(df_1$Country))
fig <- list()
country <- country_list[i]
df_1 <- read.xlsx("Fig Data/fig2.xlsx",
sheet = "Sheet 1",
detectDates = TRUE)
df_2 <- read.xlsx("Fig Data/fig2.xlsx",
sheet = "Sheet 2",
detectDates = TRUE)
i <- 1
country_list <- sort(unique(df_1$Country))
fig <- list()
country <- country_list[i]
df_country <- df_1  |>
filter(Country == country) |>
select(-Country)
View(df_1)
df_country <- df_1  |>
filter(country == country) |>
select(-country)
View(df_country)
df_country <- df_1  |>
filter(country == country) |>
select(-c(country, model))
View(df_country)
fig[[paste('panel', letters[i*2])]] <- df_country
df_country <- df_2 |>
filter(country == country) |>
select(-country)
df_country <- df_2 |>
filter(country == country)  |>
select(-c(country, model))
df_1 <- read.xlsx("Fig Data/fig2.xlsx",
sheet = "Sheet 1",
detectDates = TRUE)
df_2 <- read.xlsx("Fig Data/fig2.xlsx",
sheet = "Sheet 2",
detectDates = TRUE)
i <- 1
country_list <- sort(unique(df_1$Country))
fig <- list()
for (i in 1:length(country_list)) {
country <- country_list[i]
df_country <- df_1  |>
filter(country == country) |>
select(-c(country, model))
fig[[paste('panel', letters[i*2])]] <- df_country
df_country <- df_2 |>
filter(country == country)  |>
select(-c(country, model))
fig[[paste('panel', letters[i*2 - 1])]] <- df_country
}
df_1 <- read.xlsx("Fig Data/fig2.xlsx",
sheet = "Sheet 1",
detectDates = TRUE)
df_2 <- read.xlsx("Fig Data/fig2.xlsx",
sheet = "Sheet 2",
detectDates = TRUE)
i <- 1
country_list <- sort(unique(df_1$Country))
i <- 1
country_list <- sort(unique(df_1$country))
fig <- list()
for (i in 1:length(country_list)) {
country <- country_list[i]
df_country <- df_1  |>
filter(country == country) |>
select(-c(country, model))
fig[[paste('panel', letters[i*2])]] <- df_country
df_country <- df_2 |>
filter(country == country)  |>
select(-c(country, model))
fig[[paste('panel', letters[i*2 - 1])]] <- df_country
}
write.xlsx(fig, "appendix/fig data/fig 2.xlsx", asTable = TRUE, rowNames = FALSE)
i <- 1
country_list <- sort(unique(df_1$country))
fig <- list()
for (i in 1:length(country_list)) {
country <- country_list[i]
df_country <- df_2 |>
filter(country == country)  |>
select(-c(country, model))
fig[[paste('panel', letters[i*2 - 1])]] <- df_country
df_country <- df_1  |>
filter(country == country) |>
select(-c(country, model))
fig[[paste('panel', letters[i*2])]] <- df_country
}
write.xlsx(fig, "appendix/fig data/fig 2.xlsx", asTable = TRUE, rowNames = FALSE)
remove(df_1, df_2, i, country_list, fig, country, df_country)
df_1 <- read.xlsx("Fig Data/fig3.xlsx",
sheet = "Sheet 1",
detectDates = TRUE)
View(df_1)
df_1 <- read.xlsx("Fig Data/fig3.xlsx",
sheet = "Sheet 1",
detectDates = TRUE)
df_2 <- read.xlsx("Fig Data/fig1.xlsx",
detectDates = TRUE) |>
filter(stage != '2023 Jun onwards')
View(df_2)
df_1 <- read.xlsx("Fig Data/fig3.xlsx",
sheet = "Sheet 1",
detectDates = TRUE)
df_2 <- read.xlsx("Fig Data/fig1.xlsx",
detectDates = TRUE) |>
filter(stage != '2023 Jun onwards')
i <- 1
country_list <- sort(unique(df_1$country))
fig <- list()
country <- country_list[i]
df_country <- df_1 |>
filter(country == country)  |>
select(-c(country, stage))
View(df_1)
df_country <- df_1 |>
filter(Country == country)  |>
select(-c(country))
country_list <- sort(unique(df_1$Country))
fig <- list()
country <- country_list[i]
df_country <- df_1 |>
filter(Country == country)  |>
select(-c(country))
df_country <- df_1 |>
filter(Country == country)  |>
select(-c(Country))
View(df_country)
df_country <- df_1 |>
filter(Country == country)  |>
select(-c(Country))
df_country$Q1[df_country$stage == "2023 Jun onwards"] <- NA
df_country$Q3[df_country$stage == "2023 Jun onwards"] <- NA
View(df_country)
df_1 <- read.xlsx("Fig Data/fig1.xlsx",
detectDates = TRUE) |>
filter(stage != '2023 Jun onwards')
i <- 1
country_list <- sort(unique(df_1$Country))
fig <- list()
df_country <- df_1 |>
filter(Country == country)  |>
select(-c(Country))
country <- country_list[i]
df_country <- df_1 |>
filter(Country == country)  |>
select(-c(Country))
df_1 <- read.xlsx("Fig Data/fig1.xlsx",
detectDates = TRUE) |>
filter(stage != '2023 Jun onwards')
i <- 1
country_list <- sort(unique(df_1$Country))
fig <- list()
View(df_country)
View(df_country)
df_1 <- read.xlsx("Fig Data/fig1.xlsx",
detectDates = TRUE)
i <- 1
country_list <- sort(unique(df_1$Country))
fig <- list()
country <- country_list[i]
df_country <- df_1 |>
filter(Country == country)  |>
select(-c(Country))
fig[[paste('panel', letters[i*2 - 1])]] <- df_country
df_country <- df_1 |>
filter(Country == country)  |>
select(-c(Country)) |>
filter(stage != '2023 Jun onwards') |>
group_by(stage) |>
summarise(Max = max(Cases),
Q3 = quantile(Cases, 0.75),
Median = median(Cases),
Q1 = quantile(Cases, 0.25),
Min = min(Cases))
df_1 <- read.xlsx("Fig Data/fig1.xlsx",
detectDates = TRUE)
i <- 1
country_list <- sort(unique(df_1$Country))
fig <- list()
for (i in 1:length(country_list)) {
country <- country_list[i]
df_country <- df_1 |>
filter(Country == country)  |>
select(-c(Country))
fig[[paste('panel', letters[i*2 - 1])]] <- df_country
df_country <- df_1 |>
filter(Country == country)  |>
select(-c(Country)) |>
filter(stage != '2023 Jun onwards') |>
group_by(stage) |>
summarise(Max = max(Cases),
Q3 = quantile(Cases, 0.75),
Median = median(Cases),
Q1 = quantile(Cases, 0.25),
Min = min(Cases))
fig[[paste('panel', letters[i*2])]] <- df_country
}
View(fig)
df_1 <- read.xlsx("Fig Data/fig1.xlsx",
detectDates = TRUE)
i <- 1
country_list <- sort(unique(df_1$Country))
fig <- list()
for (i in 1:length(country_list)) {
country <- country_list[i]
df_country <- df_1 |>
filter(Country == country)  |>
select(-c(Country))
fig[[paste('panel', letters[i*2 - 1])]] <- df_country
df_country <- df_1 |>
filter(Country == country)  |>
select(-c(Country)) |>
filter(stage != '2023 Jun onwards') |>
group_by(stage) |>
summarise(Max = max(Cases),
Q3 = quantile(Cases, 0.75),
Median = median(Cases),
Q1 = quantile(Cases, 0.25),
Min = min(Cases))
fig[[paste('panel', letters[i*2])]] <- df_country
}
write.xlsx(fig, "appendix/fig data/fig 3.xlsx", asTable = TRUE, rowNames = FALSE)
remove(df_1, i, country_list, fig, country, df_country)
df_1 <- read.xlsx("Fig Data/fig4.xlsx",
sheet = "Sheet 1",
detectDates = TRUE)
df_2 <- read.xlsx("Fig Data/fig4.xlsx",
sheet = "Sheet 2",
detectDates = TRUE)
i <- 1
country_list <- sort(unique(df_1$country))
fig <- list()
country <- country_list[i]
df_country <- df_2 |>
filter(country == country)  |>
select(-c(country, model))
fig[[paste('panel', letters[i*2 - 1])]] <- df_country
df_country <- df_1  |>
filter(country == country) |>
select(-c(country, model))
fig[[paste('panel', letters[i*2])]] <- df_country
fig <- list()
for (i in 1:length(country_list)) {
country <- country_list[i]
df_country <- df_2 |>
filter(country == country)  |>
select(-c(country, model))
fig[[paste('panel', letters[i*2 - 1])]] <- df_country
df_country <- df_1  |>
filter(country == country) |>
select(-c(country, model))
fig[[paste('panel', letters[i*2])]] <- df_country
}
write.xlsx(fig, "appendix/fig data/fig 4.xlsx", asTable = TRUE, rowNames = FALSE)
remove(df_1, df_2, i, country_list, fig, country, df_country)
