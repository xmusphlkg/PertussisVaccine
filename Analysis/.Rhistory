expand = c(0, 0)) +
theme_bw() +
theme(legend.position = 'bottom') +
labs(x = 'Year',
y = 'Percentage',
fill = 'Age Group')
ggsave(filename = './appendix/S7.png',
plot = fig,
dpi = 300,
width = 12,
height = 3.5)
fig <- ggplot(df, aes(x = year, y = count, fill = age_group_10)) +
geom_col(position = 'fill', show.legend = T) +
coord_cartesian(ylim = c(0, 1)) +
scale_fill_manual(values = fill_color) +
scale_x_continuous(breaks = breaks,
limits = c(1990.5, 2023.5),
expand = c(0, 0)) +
scale_y_continuous(labels = scales::percent_format(),
expand = c(0, 0)) +
theme_bw() +
theme(legend.position = 'bottom') +
labs(x = 'Year',
y = 'Percentage',
fill = 'Age Group')
fig
ggsave(filename = './appendix/S7.png',
plot = fig,
dpi = 300,
width = 12,
height = 3.5)
library(tidyverse)
library(lubridate)
library(ggsci)
library(patchwork)
library(openxlsx)
library(lme4)
library(lmerTest)
library(emmeans)
library(ggpubr)
library(tidyverse)
library(lubridate)
library(ggsci)
library(patchwork)
library(openxlsx)
library(lme4)
library(lmerTest)
library(emmeans)
library(ggpubr)
fill_color <- pal_npg()(3)
# Load data
df_raw <- read.xlsx('./Fig Data/fig1.xlsx', detectDates = T) |>
arrange(Date)
df_clean <- df_raw |>
group_by(Country, stage, Month, Week) |>
summarise(median = median(Cases),
Q1 = quantile(Cases, 0.25),
Q3 = quantile(Cases, 0.75),
.groups = 'drop')
scientific_10 <- function(x) {
ifelse(x == 0, 0, parse(text = gsub("[+]", "", gsub("e", "%*%10^", scales::scientific_format()(x)))))
}
# au ----------------------------------------------------------------------
data <- df_raw |>
filter(Country == 'AU')
data_2023 <- df_clean |>
filter(Country == 'AU') |>
mutate(month = factor(Month,
levels = c(7:12, 1:6),
labels = 101:112),
month = as.integer(as.character(month))) |>
filter(stage == '2023 Jun onwards')
data_2022 <- df_clean |>
filter(Country == 'AU') |>
mutate(month = factor(Month,
levels = c(7:12, 1:6),
labels = 101:112),
month = as.integer(as.character(month))) |>
filter(stage != '2023 Jun onwards')
plot_breaks <- pretty(c(0, max(data$Cases)))
plot_range <- range(plot_breaks)
data$Year <- as.factor(data$Year)
data$Month <- as.factor(data$Month)
data$Stage <- factor(data$stage,
levels = unique(data$stage))
results <- lmer(Cases ~ Stage + (1|Month), data = filter(data, Stage != '2023 Jun onwards'))
emm <- emmeans(results, ~ Stage)
pairs <- pairs(emm)
pairs_summary <- summary(pairs, adjust = "bonferroni") |>
as.data.frame() |>
separate(contrast, c('stage1', 'stage2'), sep = ' \\- ') |>
rename('group1' = 'stage1',
'group2' = 'stage2') |>
mutate(y.position = plot_range[2] * 0.9,
p.value = ifelse(p.value < 0.001, '***', format(round(p.value, 3), nsmall = 3)))
fig1_1 <- ggplot(data_2022, aes(x = month, y = median)) +
geom_vline(xintercept = 106.5,
linetype = 'dashed',
color = 'black',
size = 0.5) +
geom_smooth(aes(color = stage, fill = stage),
method = 'gam',
se = T,
linewidth = 0.7) +
geom_line(data = data_2023, aes(color = stage),
linewidth = 0.7) +
geom_ribbon(data = data_2023, aes(ymin = median, ymax = median, fill = stage), alpha = 0.3) +
scale_x_continuous(breaks = 101:112,
labels = month.abb[c(7:12, 1:6)],
expand = c(0, 0)) +
scale_y_continuous(expand = c(0, 0),
label = scientific_10,
breaks = plot_breaks,
limits = plot_range) +
labs(title = 'a', x = 'Month', y = 'Monthly incidence',
color = 'Stage', fill = 'Stage') +
scale_color_manual(values = fill_color) +
scale_fill_manual(values = fill_color) +
theme_classic() +
theme(legend.box.just = "left",
legend.margin = margin(0, 0, 0, 0),
legend.background = element_rect(fill = "transparent"),
legend.text = element_text(face = "bold", size = 12),
legend.title = element_text(face = "bold", size = 12),
plot.title.position = "plot",
plot.caption.position = "plot",
plot.title = element_text(face = "bold", size = 14, hjust = 0),
axis.title = element_text(face = "bold", size = 12, color = "black"),
axis.text = element_text(size = 12, color = "black"))
fig1_1
library(forecast)
library(tidyverse)
library(lubridate)
library(ggsci)
library(patchwork)
library(forecast)
library(forecastHybrid)
library(tseries)
library(openxlsx)
fill_color <- pal_npg()(5)
names(fill_color) <- c('00-06', '07-10', '11-19', 'Missing', '20+')
df <- read.xlsx('./annual.xlsx', sheet = 'US_1')
fill_color <- pal_npg()(5)
names(fill_color) <- c('00-06', '07-10', '11-19', 'Missing', '20+')
df <- read.xlsx('./annual.xlsx', sheet = 'US_1')
View(df)
df <- read.xlsx('./annual.xlsx', sheet = 'US')
df <- read.xlsx('./annual.xlsx', sheet = 'US_1')
df <- df |>
pivot_longer(cols = 2:ncol(df), names_to = 'age_group', values_to = 'count') |>
mutate(age_group_10 = case_when(
age_group == "No.information.provided" ~ 'Missing',
age_group == '00-01' ~ '00-04',
age_group == '02-04' ~ '00-04',
age_group == '05-14' ~ '05-14',
age_group == '05-14' ~ '05-14',
# other age groups
TRUE ~ '15+'
))
library(tidyverse)
library(openxlsx)
library(patchwork)
library(ggsci)
breaks <- seq(1991, 2023, 2)
fill_color <- pal_npg()(4)
names(fill_color) <- c('00-04', '05-14', '15+', 'Missing')
# AU ----------------------------------------------------------------------
df <- read.xlsx('./annual.xlsx', sheet = 'AU')
df <- df |>
pivot_longer(cols = 2:ncol(df), names_to = 'age_group', values_to = 'count') |>
mutate(age_group_10 = case_when(
age_group == "No.information.provided" ~ 'Missing',
age_group == '00-04' ~ '00-04',
age_group == '05-09' ~ '05-14',
age_group == '10-14' ~ '05-14',
# other age groups
TRUE ~ '15+'
))
names(df)[1] <- 'year'
df <- df |>
filter(year <= 2023)
fig1 <- ggplot(df, aes(x = year, y = count, fill = age_group_10)) +
geom_col(position = 'fill') +
coord_cartesian(ylim = c(0, 1)) +
scale_fill_manual(values = fill_color) +
scale_x_continuous(breaks = breaks,
limits = c(1990.5, 2023.5),
expand = c(0, 0)) +
scale_y_continuous(labels = scales::percent_format(),
expand = c(0, 0)) +
theme_bw() +
labs(title = 'a',
x = 'Year',
y = 'Percentage',
fill = 'Age Group')
# CN ----------------------------------------------------------------------
df <- read.xlsx('./annual.xlsx', sheet = 'CN')
df <- df |>
pivot_longer(cols = 2:ncol(df), names_to = 'year', values_to = 'count') |>
rename(age_group = 'Age.Group') |>
mutate(age_group_10 = case_when(
age_group == '0-' ~ '00-04',
age_group == '1-' ~ '00-04',
age_group == '2-' ~ '00-04',
age_group == '3-' ~ '00-04',
age_group == '4-' ~ '00-04',
age_group == '5-' ~ '05-14',
age_group == '6-' ~ '05-14',
age_group == '7-' ~ '05-14',
age_group == '8-' ~ '05-14',
age_group == '9-' ~ '05-14',
age_group == '10-' ~ '05-14',
age_group == '11-' ~ '05-14',
age_group == '12-' ~ '05-14',
age_group == '13-' ~ '05-14',
age_group == '14-' ~ '05-14',
# other age groups
TRUE ~ '15+'),
year = as.integer(year))
df <- df |>
filter(year <= 2023)
fig2 <- ggplot(df, aes(x = year, y = count, fill = age_group_10)) +
geom_col(position = 'fill', show.legend = F) +
coord_cartesian(ylim = c(0, 1)) +
scale_fill_manual(values = fill_color) +
scale_x_continuous(breaks = breaks,
limits = c(1990.5, 2023.5),
expand = c(0, 0)) +
scale_y_continuous(labels = scales::percent_format(),
expand = c(0, 0)) +
theme_bw() +
labs(title = 'b',
x = 'Year',
y = 'Percentage',
fill = 'Age Group')
# US ----------------------------------------------------------------------
df <- read.xlsx('./annual.xlsx', sheet = 'US_1')
df <- df |>
pivot_longer(cols = 2:ncol(df), names_to = 'age_group', values_to = 'count') |>
mutate(age_group_10 = case_when(
age_group == "No.information.provided" ~ 'Missing',
age_group == '00-01' ~ '00-04',
age_group == '02-04' ~ '00-04',
age_group == '05-14' ~ '05-14',
age_group == '05-14' ~ '05-14',
# other age groups
TRUE ~ '15+'
))
names(df)[1] <- 'year'
df <- df |>
filter(year <= 2023)
fig3 <- ggplot(df, aes(x = year, y = count, fill = age_group_10)) +
geom_col(position = 'fill', show.legend = F) +
coord_cartesian(ylim = c(0, 1)) +
scale_fill_manual(values = fill_color) +
scale_x_continuous(breaks = breaks,
limits = c(1990.5, 2023.5),
expand = c(0, 0)) +
scale_y_continuous(labels = scales::percent_format(),
expand = c(0, 0)) +
theme_bw() +
labs(title = 'c',
x = 'Year',
y = 'Percentage',
fill = 'Age Group')
# UK ----------------------------------------------------------------------
df <- read.xlsx('./annual.xlsx', sheet = 'UK')
df <- df |>
pivot_longer(cols = 2:ncol(df), names_to = 'age_group', values_to = 'count') |>
mutate(age_group_10 = case_when(
age_group == "No.information.provided" ~ 'Missing',
age_group == '00-04' ~ '00-04',
age_group == '05-09' ~ '05-14',
age_group == '10-14' ~ '05-14',
# other age groups
TRUE ~ '15+'
))
names(df)[1] <- 'year'
df <- df |>
filter(year <= 2023)
fig4 <- ggplot(df, aes(x = year, y = count, fill = age_group_10)) +
geom_col(position = 'fill', show.legend = F) +
coord_cartesian(ylim = c(0, 1)) +
scale_fill_manual(values = fill_color) +
scale_x_continuous(breaks = breaks,
limits = c(1990.5, 2023.5),
expand = c(0, 0)) +
scale_y_continuous(labels = scales::percent_format(),
expand = c(0, 0)) +
theme_bw() +
labs(title = 'd',
x = 'Year',
y = 'Percentage',
fill = 'Age Group')
fig <- fig1 + fig2 + fig3 + fig4 +
plot_layout(ncol = 1, guides = 'collect') & theme(legend.position = 'bottom')
ggsave(filename = './appendix/S6.png',
plot = fig,
dpi = 300,
width = 12,
height = 12)
df <- read.xlsx('./annual.xlsx', sheet = 'US_1')
View(df)
df <- read.xlsx('./annual.xlsx', sheet = 'US')
df <- df |>
pivot_longer(cols = 2:ncol(df), names_to = 'age_group', values_to = 'count') |>
mutate(age_group_10 = case_when(
age_group == "No.information.provided" ~ 'Missing',
age_group == '00-01' ~ '00-04',
age_group == '02-04' ~ '00-04',
age_group == '05-14' ~ '05-14',
age_group == '05-14' ~ '05-14',
# other age groups
TRUE ~ '15+'
))
names(df)[1] <- 'year'
df <- df |>
filter(year <= 2023)
fig3 <- ggplot(df, aes(x = year, y = count, fill = age_group_10)) +
geom_col(position = 'fill', show.legend = F) +
coord_cartesian(ylim = c(0, 1)) +
scale_fill_manual(values = fill_color) +
scale_x_continuous(breaks = breaks,
limits = c(1990.5, 2023.5),
expand = c(0, 0)) +
scale_y_continuous(labels = scales::percent_format(),
expand = c(0, 0)) +
theme_bw() +
labs(title = 'c',
x = 'Year',
y = 'Percentage',
fill = 'Age Group')
fig3
library(tidyverse)
library(openxlsx)
library(patchwork)
library(ggsci)
breaks <- seq(1991, 2023, 2)
fill_color <- pal_npg()(4)
names(fill_color) <- c('00-04', '05-14', '15+', 'Missing')
# AU ----------------------------------------------------------------------
df <- read.xlsx('./annual.xlsx', sheet = 'AU')
df <- df |>
pivot_longer(cols = 2:ncol(df), names_to = 'age_group', values_to = 'count') |>
mutate(age_group_10 = case_when(
age_group == "No.information.provided" ~ 'Missing',
age_group == '00-04' ~ '00-04',
age_group == '05-09' ~ '05-14',
age_group == '10-14' ~ '05-14',
# other age groups
TRUE ~ '15+'
))
names(df)[1] <- 'year'
df <- df |>
filter(year <= 2023)
fig1 <- ggplot(df, aes(x = year, y = count, fill = age_group_10)) +
geom_col(position = 'fill') +
coord_cartesian(ylim = c(0, 1)) +
scale_fill_manual(values = fill_color) +
scale_x_continuous(breaks = breaks,
limits = c(1990.5, 2023.5),
expand = c(0, 0)) +
scale_y_continuous(labels = scales::percent_format(),
expand = c(0, 0)) +
theme_bw() +
labs(title = 'a',
x = 'Year',
y = 'Percentage',
fill = 'Age Group')
# CN ----------------------------------------------------------------------
df <- read.xlsx('./annual.xlsx', sheet = 'CN')
df <- df |>
pivot_longer(cols = 2:ncol(df), names_to = 'year', values_to = 'count') |>
rename(age_group = 'Age.Group') |>
mutate(age_group_10 = case_when(
age_group == '0-' ~ '00-04',
age_group == '1-' ~ '00-04',
age_group == '2-' ~ '00-04',
age_group == '3-' ~ '00-04',
age_group == '4-' ~ '00-04',
age_group == '5-' ~ '05-14',
age_group == '6-' ~ '05-14',
age_group == '7-' ~ '05-14',
age_group == '8-' ~ '05-14',
age_group == '9-' ~ '05-14',
age_group == '10-' ~ '05-14',
age_group == '11-' ~ '05-14',
age_group == '12-' ~ '05-14',
age_group == '13-' ~ '05-14',
age_group == '14-' ~ '05-14',
# other age groups
TRUE ~ '15+'),
year = as.integer(year))
df <- df |>
filter(year <= 2023)
fig2 <- ggplot(df, aes(x = year, y = count, fill = age_group_10)) +
geom_col(position = 'fill', show.legend = F) +
coord_cartesian(ylim = c(0, 1)) +
scale_fill_manual(values = fill_color) +
scale_x_continuous(breaks = breaks,
limits = c(1990.5, 2023.5),
expand = c(0, 0)) +
scale_y_continuous(labels = scales::percent_format(),
expand = c(0, 0)) +
theme_bw() +
labs(title = 'b',
x = 'Year',
y = 'Percentage',
fill = 'Age Group')
# US ----------------------------------------------------------------------
df <- read.xlsx('./annual.xlsx', sheet = 'US')
df <- df |>
pivot_longer(cols = 2:ncol(df), names_to = 'age_group', values_to = 'count') |>
mutate(age_group_10 = case_when(
age_group == "No.information.provided" ~ 'Missing',
age_group == '00-01' ~ '00-04',
age_group == '02-04' ~ '00-04',
age_group == '05-14' ~ '05-14',
age_group == '05-14' ~ '05-14',
# other age groups
TRUE ~ '15+'
))
names(df)[1] <- 'year'
df <- df |>
filter(year <= 2023)
fig3 <- ggplot(df, aes(x = year, y = count, fill = age_group_10)) +
geom_col(position = 'fill', show.legend = F) +
coord_cartesian(ylim = c(0, 1)) +
scale_fill_manual(values = fill_color) +
scale_x_continuous(breaks = breaks,
limits = c(1990.5, 2023.5),
expand = c(0, 0)) +
scale_y_continuous(labels = scales::percent_format(),
expand = c(0, 0)) +
theme_bw() +
labs(title = 'c',
x = 'Year',
y = 'Percentage',
fill = 'Age Group')
# UK ----------------------------------------------------------------------
df <- read.xlsx('./annual.xlsx', sheet = 'UK')
df <- df |>
pivot_longer(cols = 2:ncol(df), names_to = 'age_group', values_to = 'count') |>
mutate(age_group_10 = case_when(
age_group == "No.information.provided" ~ 'Missing',
age_group == '00-04' ~ '00-04',
age_group == '05-09' ~ '05-14',
age_group == '10-14' ~ '05-14',
# other age groups
TRUE ~ '15+'
))
names(df)[1] <- 'year'
df <- df |>
filter(year <= 2023)
fig4 <- ggplot(df, aes(x = year, y = count, fill = age_group_10)) +
geom_col(position = 'fill', show.legend = F) +
coord_cartesian(ylim = c(0, 1)) +
scale_fill_manual(values = fill_color) +
scale_x_continuous(breaks = breaks,
limits = c(1990.5, 2023.5),
expand = c(0, 0)) +
scale_y_continuous(labels = scales::percent_format(),
expand = c(0, 0)) +
theme_bw() +
labs(title = 'd',
x = 'Year',
y = 'Percentage',
fill = 'Age Group')
fig <- fig1 + fig2 + fig3 + fig4 +
plot_layout(ncol = 1, guides = 'collect') & theme(legend.position = 'bottom')
ggsave(filename = './appendix/S6.png',
plot = fig,
dpi = 300,
width = 12,
height = 12)
fill_color <- pal_npg()(5)
names(fill_color) <- c('00-06', '07-10', '11-19', 'Missing', '20+')
fill_color <- pal_npg()(5)
names(fill_color) <- c('00-06', '07-10', '11-19', 'Missing', '20+')
df <- read.xlsx('./annual.xlsx', sheet = 'US_1')
df <- df |>
pivot_longer(cols = 2:ncol(df), names_to = 'age_group', values_to = 'count') |>
mutate(age_group_10 = case_when(
age_group == "No.information.provided" ~ 'Missing',
age_group == '<6mos' ~ '00-06',
age_group == '6-11mos' ~ '00-06',
age_group == '01-06' ~ '00-06',
# other age groups
TRUE ~ as.character(age_group)
))
names(df)[1] <- 'year'
df <- df |>
filter(year <= 2023)
fig <- ggplot(df, aes(x = year, y = count, fill = age_group_10)) +
geom_col(position = 'fill', show.legend = T) +
coord_cartesian(ylim = c(0, 1)) +
scale_fill_manual(values = fill_color) +
scale_x_continuous(breaks = breaks,
limits = c(1990.5, 2023.5),
expand = c(0, 0)) +
scale_y_continuous(labels = scales::percent_format(),
expand = c(0, 0)) +
theme_bw() +
theme(legend.position = 'bottom') +
labs(x = 'Year',
y = 'Percentage',
fill = 'Age Group')
ggsave(filename = './appendix/S7.png',
plot = fig,
dpi = 300,
width = 12,
height = 3.5)
